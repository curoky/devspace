name: Bootstrap OSX

on:
  push:
  schedule:
    - cron: '0 0 28 * *'
  workflow_dispatch:

jobs:
  main:
    runs-on: macos-latest
    env:
      HOMEBREW_NO_ANALYTICS: 1
      HOMEBREW_NO_AUTO_UPDATE: 1
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        if: 'false'
        with:
          python-version: '3.x'
          cache: 'pip'

      - run: python3 -m pip install opencc

      - run: bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"

      - run: curl -sSL https://raw.githubusercontent.com/curoky/dotbox/master/config/brew/Brewfile.osx | brew bundle --file=- --cleanup

      - run: curl -sSL https://raw.githubusercontent.com/curoky/dotbox/master/config/brew/Brewfile.linux | brew bundle --file=- --cleanup || echo ignore

      # - run: script/osx-hack.sh

      - run: sudo chown -R $(whoami) /opt

      - run: ./images/script/setup-bundles.sh /opt/bundles

      - run: ./bootstrap.sh
